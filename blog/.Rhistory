library(XML)
setwd("/Users/johan.renaudie/Documents/Programming/#GitHub/plannapus.github.io/blog")
entries <- dir(pattern="[0-9].html")
process <- function(html_file){
h <-htmlParse(html_file)
tit <- xpathSApply(h,"//p[@class='blog-title']",xmlValue)
dat <- xpathSApply(h,"//p[@class='blog-date']",xmlValue)
desc <- xpathSApply(h,"//p[@class='blog-content']",xmlValue)
data.frame(url=html_file,title=tit,date=as.Date(dat),content=desc)
}
all <- do.call(rbind,lapply(entries,process))
all <- all[order(all$date,decreasing=TRUE),]
index <- readLines("index.html")
rss <- readLines("rss.xml")
#index[grepl("Latest entry",index)] <- sprintf("\t\t\t<h3><a href=\"%s\">Latest entry</a></h3> <br/>",all$url[1])
j <- sprintf("\t\t\t<tr><td class=\"date\">%s</td><td class=\"title\"><a href=\"%s\">%s</a></td></tr>",all$date, all$url, all$title)
index <- c(index[1:grep("<table",index)],j,index[grep("</table",index):length(index)])
cat(index,file="index.html",sep="\n")
rss_header <- "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<rss version=\"2.0\">\n<channel><title>Johan Renaudie - Blog</title><link>https://plannapus.github.io/blog/index.html</link><description>A little bit of science, a little bit of programming, a little bit of cooking...</description>"
rss_footer <- "</channel>\n</rss>"
k <- sprintf("<item><title>%s</title><link>%s</link><pubDate>%s</pubDate><description>%s</description></item>",all$title,paste0("http://plannapus.github.io/blog/",all$url),all$date,gsub("^[[:space:]]+|\\..+$","",all$content))
cat(rss_header,k,rss_footer,file="rss.xml",sep="\n")
